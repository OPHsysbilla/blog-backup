---
title: 计算机网络常见面试整理
date: 2020-11-09 19:05:58
tags:
    - 面试
categories: 面试
---

## 长连接和短连接是什么？为什么是必要的？


### Http加密过程是怎样的

#### 让第三方CA来确保server公钥正确

<!--more-->

 1）server向CA提供基本信息、公钥等，CA用CA私钥对server公钥和信息进行加密形成数字证书（防止server被伪造）。
2）client向server发出https请求和随机数c，server返回数字证书和随机数s。
3）client收到数字证书，用CA公钥对数字证书进行解密，得到server的公钥。
> 得到server公钥后，client可以用server公钥解密server签名得到摘要。
> client也把原文hash一遍得到的摘要比对，确认内容没有经过更改

#### 生成会话密钥
client用server公钥加密client生成的随机数premaster secret，发送给server。
server收到加密的随机数premaster secret，用server私钥解密随机数，然后和随机数c、随机数s一起生成会话密钥。此时client也拥有三个随机数生成相同的会话密钥(Session Key)。双方用会话密钥进行加密通信（防止内容被窃听进行加密） 

> 用会话密钥(Session Key)进行加密通信是对称加密的。如DES，AES等对称加密，只有一把钥匙
> 而获得会话密钥的过程是不对称加密的。最常见的非对称加密是RSA，有公钥和私钥，公钥加密只有私钥解密，私钥加密只有对应公钥解密

#### 如何防止数据被篡改
1. 数字签名是server对通信内容进行hash，得到信息摘要。
2. 然后用server私钥对摘要进行加密得到数字签名。server把明文连同数字签名一起发送给client
3. client用server公钥对数字签名解密得到信息摘要，然后用相同的hash对数据进行计算得到信息摘要，比对两个信息摘要是否一致。

## tcp三次握手问题

### 为什么TIME_WAIT状态还需要等2MSL后才能返回到CLOSED状态？
**TIME_WAIT状态的作用就是用来重发可能丢失的ACK报文。**

> 虽然双方都同意关闭连接了，但网络是不可靠的，你无法保证你最后发送的ACK报文会一定被对方收到，因此对方处于LAST_ACK状态下的Socket可能会因为超时未收到ACK报文，而重发FIN报文

#### TIME_WAIT状态所导致的服务器问题

一台机器上端口号数量的上限是65536个，[TCP服务器最大并发连接数是多少？](https://segmentfault.com/a/1190000014044351)。

- 如果在同一台机器上进行压力测试模拟上万的客户请求，并且循环与服务端进行短连接通信，那么这台机器将产生4000个左右的TIME_WAIT Socket，后续的短连接就会产生address already in use : connect的异常
- 如果使用Nginx作为方向代理也需要考虑TIME_WAIT状态，发现系统存在大量TIME_WAIT状态的连接，通过调整内核参数解决。

#### 心跳包作用及格式

作用是保持长连接避免不断创建tcp连接

心跳包格式的定义及处理
报文头的定义，就是你发送数据的时候需要先发送报文头，报文里面能解析出你将要发送的数据长度
你发送数据包的格式，是json的还是其他序列化的方式

### Socket连接池干嘛的
Socket连接池，就是维护着一定数量Socket长连接的集合。它能自动检测Socket长连接的有效性，剔除无效的连接，补充连接池的长连接的数量